<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><meta name="baidu-site-verification" content="code-KCMz4b3cnd"><meta name="google-site-verification" content="MTp8U7dJ1uzrfz8Mu6rgqX1CIm3HjqPWd0xaRcv1tFg"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/favicon.png" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"aisakaaoi.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!1,nav:null,activeClass:"valine"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="本文将通过实现一个简单的歌词生成AI，快速了解深度学习的基本流程以及PyTorch这款必备的深度学习框架。  介绍首先我们要知道，深度学习或者说神经网络的本质其实是一个数学问题。我们可以通过“训练”让一个神经网络学习“输入”到“输出”之间的数据映射关系。"><meta property="og:type" content="article"><meta property="og:title" content="深度学习-浅显易懂的PyTorch深度学习入门"><meta property="og:url" content="https://aisakaaoi.github.io/d1d6413c.html"><meta property="og:site_name" content="逢坂葵的个人博客"><meta property="og:description" content="本文将通过实现一个简单的歌词生成AI，快速了解深度学习的基本流程以及PyTorch这款必备的深度学习框架。  介绍首先我们要知道，深度学习或者说神经网络的本质其实是一个数学问题。我们可以通过“训练”让一个神经网络学习“输入”到“输出”之间的数据映射关系。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/1.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/2.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/3.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/4.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/5.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/6.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/7.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/8.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/9.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/10.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/11.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/12.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/13.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/14.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/15.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/16.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/17.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/18.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/19.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/20.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/21.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/22.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/23.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/24.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/25.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/26.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/27.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/28.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/29.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/30.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/31.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/32.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/33.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/34.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/35.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/36.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/37.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/38.webp"><meta property="og:image" content="https://aisakaaoi.github.io/d1d6413c/39.webp"><meta property="article:published_time" content="2021-10-15T02:06:12.000Z"><meta property="article:modified_time" content="2023-12-28T03:15:06.881Z"><meta property="article:author" content="Aisaka Aoi"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://aisakaaoi.github.io/d1d6413c/1.webp"><link rel="canonical" href="https://aisakaaoi.github.io/d1d6413c.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>深度学习-浅显易懂的PyTorch深度学习入门 | 逢坂葵的个人博客</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?7308ed05421777c301eefa3754da1b42",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="逢坂葵的个人博客" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">aoi学院</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Aisaka's Blog, School of Aoi, Aisaka University</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">50</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">9</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">864</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><a href="https://github.com/AisakaAoi" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://aisakaaoi.github.io/d1d6413c.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/manatsu.jpg"><meta itemprop="name" content="Aisaka Aoi"><meta itemprop="description" content="Aisaka's Blog, School of Aoi, Aisaka University"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="逢坂葵的个人博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">深度学习-浅显易懂的PyTorch深度学习入门</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-10-15 10:06:12" itemprop="dateCreated datePublished" datetime="2021-10-15T10:06:12+08:00">2021-10-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%F0%9F%8C%99%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">🌙进阶学习</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%F0%9F%8C%99%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/%E2%AD%90%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD-Artificial-Intelligence/" itemprop="url" rel="index"><span itemprop="name">⭐人工智能 Artificial Intelligence</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%F0%9F%8C%99%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/%E2%AD%90%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD-Artificial-Intelligence/%F0%9F%92%AB-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-Deep-Learning-Basic-Concepts/" itemprop="url" rel="index"><span itemprop="name">💫_深度学习基本概念 Deep Learning Basic Concepts</span></a> </span></span><span id="/d1d6413c.html" class="post-meta-item leancloud_visitors" data-flag-title="深度学习-浅显易懂的PyTorch深度学习入门" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/d1d6413c.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/d1d6413c.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.8k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>12 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>本文将通过实现一个简单的歌词生成AI，快速了解深度学习的基本流程以及PyTorch这款必备的深度学习框架。</p><hr><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>首先我们要知道，深度学习或者说神经网络的本质其实是一个数学问题。我们可以通过“训练”让一个神经网络学习“输入”到“输出”之间的数据映射关系。</p><img src="/d1d6413c/1.webp"> <span id="more"></span><p>例如当神经网络看到这张图片时，它应该知道输出是一只狗。</p><img src="/d1d6413c/2.webp"><p>在PyTorch中，构建神经网络的核心数据结构是一个叫做张量（Tensor）的东西。</p><img src="/d1d6413c/3.webp"><p>它和numpy数组非常类似，不过Tensor的运算可以被放在GPU上执行，利用GPU的并行运算来加速整个计算过程。在Tensor之上，我们可以构建各种复杂的数学模型。</p><img src="/d1d6413c/4.webp"><p>PyTorch同时提供了梯度（Gradient）的自动计算，梯度你可以简单理解为导数在高维度上的推广。</p><img src="/d1d6413c/5.webp"><p>这是因为对于神经网络的“训练”，或者说一般的最优化问题，大家会用到一个核心算法————梯度下降（gradient descent）。</p><img src="/d1d6413c/6.webp"><p>而PyTorch将偏导数的计算、链式法则这些细节全都隐藏在了框架中，因此我们可以关注于解决实际问题，而不是这些繁琐的计算细节。</p><img src="/d1d6413c/7.webp"><p>除了这些基本的计算功能以外，PyTorch对神经网络还有各种模块化的封装，比如常见的卷积层（conv layer）、线性层（linear layer）、池化层（pooling layer）、padding layer、各种激活函数、CNN、RNN、Transformer模型等等。</p><hr><h3 id="安装PyTorch"><a href="#安装PyTorch" class="headerlink" title="安装PyTorch"></a>安装PyTorch</h3><p>PyTorch的安装还是非常容易的，我们可以在<a target="_blank" rel="noopener" href="https://pytorch.org/">PyTorch官网</a>选择对应的操作系统、CUDA版本，Anaconda其实不是必须的，只是可以更好地进行包管理。最后复制下面的命令到控制台安装即可。</p><img src="/d1d6413c/8.webp"><hr><h3 id="数据集（Dataset）"><a href="#数据集（Dataset）" class="headerlink" title="数据集（Dataset）"></a>数据集（Dataset）</h3><p>训练的第一步是准备我们需要的原始数据，数据集（Dataset）通常很容易被我们忽视，但又是深度学习中相当重要的一环。有时候即使你的模型再好，但是训练的数据很差，最后也很难得到一个好的结果。</p><p>这里使用的是这个<a target="_blank" rel="noopener" href="https://www.heywhale.com/mw/dataset/5e6382164b7a30002c98c62c">中文歌词语料库</a>。</p><img src="/d1d6413c/9.webp"><p>在下载的原始数据集中我们可以看到很多非中文歌曲，以及有些歌词中的格式不工整，有些歌词的前面包含了不需要的信息。</p><img src="/d1d6413c/10.webp"><p>因此我们需要对这些原始数据做一些预处理（Data Preprocessing），并将数据转换成我们需要的格式。需要写一个处理脚本data_preprocess.py，过滤掉不需要的歌词，去除多余的文件，并以斜杠来分隔歌词的每一句，每一行是一首歌的歌词，最后存放在一个纯文本中（data&#x2F;lyrics.txt）。</p><p>接下来可以利用PyTorch提供的DataSet和DataLoader来读取这个歌词文件。这两个类封装了基本的数据操作，比如切分训练数据、随机打乱数据、或者对数据进行简单变换等等，这样我们就不用自己去造轮子了。</p><img src="/d1d6413c/11.webp"><p>我们可以通过继承DataSet类来定义我们的歌词数据集，接下来我们在init函数中加载之前的这个歌词文件，并将所有的文字转换成一个个索引。【PyTorch神经网络不支持“字符”类型的输入，我们需要将文字转换成不重复的整型值才能传递给网络】</p><img src="/d1d6413c/12.webp"><p>这里我们定义两个dict用来保存索引到文字以及文字到索引的映射。</p><img src="/d1d6413c/13.webp"><p>接下来我们需要实现两个函数，第一个函数len，我们需要返回样本的总数。这里我们将所有歌词文本拆分成一个个长度为48的序列，所以样本总数（seq_len）等于文字的总数&#x2F;序列长度（48），这里为什么减1，后文会提及。</p><img src="/d1d6413c/14.webp"><p>第二个函数getitem，我们可以根据指定的下标返回对应的文字序列。</p><img src="/d1d6413c/15.webp"><p>这里返回的数据可以分为两部分，一部分代表网络的输入，另一部分代表网络的输出，输入和输出刚好相差一个字，因为输出的文字刚好是对下一个字的预测。</p><img src="/d1d6413c/16.webp"><p>定义完毕之后，我们对刚刚的代码进行一下简单测试。这里我们可以创建一个数据集对象，然后根据下标随便获取其中一个样本，可以看到返回了一个整数序列，长度为48，其中的每个数字代表一个文字的索引。</p><img src="/d1d6413c/17.webp"><p>我们当然可以根据之前创建的映射将它们再还原成一个个字符。</p><img src="/d1d6413c/18.webp"><p>这一步检查其实是很有必要的，不然一步错步步错。</p><p>在定义了Dataset之后，我们需要再创建一个DataLoader来访问其中的数据，主要是DataLoader允许我们随机打乱数据，或者按批次（batch）读取数据。</p><img src="/d1d6413c/19.webp"><p>当然这里还进一步将数据随机分成了两部分，一部分用来做训练，另一部分用来做测试（验证），原因在之后训练的时候会讲到。</p><img src="/d1d6413c/20.webp"><hr><h3 id="创建模型（Build-Model）"><a href="#创建模型（Build-Model）" class="headerlink" title="创建模型（Build Model）"></a>创建模型（Build Model）</h3><p>接下来，我们来定义我们用到的这个神经网络结构。</p><p>在PyTorch中，我们可以通过继承nn中的Module类来定义一个神经网络。这里最关键的是forward函数，它定义了我们网络从输入到输出的整个计算过程，比如数据会经过哪些层、层与层之间应当如何连接等等。</p><img src="/d1d6413c/21.webp"><p>在定义模型时，有一点非常重要，不管我们要解决的问题有多么复杂，最好都先从构建一个最基本的模型开始，这样会大大降低训练和调试的难度，并且我们在增加模型复杂度之后，可以以这个简单的模型做参照，确保复杂的模型是否能真的表现的更好。</p><p>其实对于文本生成问题，使用当下最流行的Transformer架构应该是更好的选择。</p><img src="/d1d6413c/22.webp"><p>不过这里我们先用一个更加简单、基本的RNN（Recurrent Neural Network，循环神经网络：特指将当前的状态信息循环传递给自身的网络模型）模型来做演示。</p><p>首先我们会将这里输入的文字经过一个embedding层转换成一个向量，因为高维向量能够很好地表示不同文字间的语义关联。</p><p>接着我们将这个向量传入一个LSTM单元，最后通过一个线性层转换成输出的文字。</p><img src="/d1d6413c/23.webp"><p>和所有的分类问题（categorization）一样，这里的文字是使用one-hot向量来编码的。</p><p>另外LSTM单元同时有一个隐藏状态的输入和一个隐藏状态的输出，正是因为有这个隐藏状态，才使得我们的神经网络具有记忆的能力，因为我们不希望生成的歌词前言不搭后语，我们需要让模型记住文字前后的关系。</p><hr><h3 id="训练（Training）"><a href="#训练（Training）" class="headerlink" title="训练（Training）"></a>训练（Training）</h3><p>在训练的过程中，每次会从数据中抽取一小部分（称之为一个batch），然后我们会一个batch接着一个batch训练。</p><p>当所有的数据都被训练过一遍之后（称之为一个epoch），通过我们会对模型训练若干个epoch，让它更好地去拟合训练数据。</p><p>我们可以在循环中实现整个训练的过程，对于每个epoch，我们会一个batch接着一个batch地训练。</p><img src="/d1d6413c/24.webp"><p>标记代码单纯代表将训练数据上传至GPU，如果使用GPU来加速训练过程的话是有必要的。</p><p>接下来我们将数据传入之前创建的模型，让模型预测一个输出，然后我们会去计算这个输出与标准答案（ground truth）之间的“差异”，这里我们会用到损失函数（Loss Function）。</p><p>对于不同的问题，我们会用到不同的损失函数，比如对于纯数值类型的输出（Scalar Output），像温度、房价、身高…，这个loss可以简单是输出与标准答案的绝对值或者是平方差。</p><img src="/d1d6413c/25.webp"><p>而对于我们这种情况，由于我们的输出是ont-hot编码的文字，因此我们会用到交叉熵（Cross Entropy），可以简单将这个loss理解为输出与标准答案之间的差距，通常我们希望这个loss越小越好，这样代表预测的结果与标准答案更接近。</p><img src="/d1d6413c/26.webp"><p>我们训练神经网络的目标，就是通过缓慢调节网络中的各种权重（Weight）来降低这个loss，用到的算法就是之前提到的梯度下降。关于梯度的计算，我们可以轻松地通过调用一句backward()完成，然后我们可以调用optimizer的step()，通过计算得到的梯度自动修改网络的权重。</p><p>其中optimizer.zero_grad()也非常重要，它会在计算之前先将梯度清零，避免我们得到一个累加的梯度值。</p><img src="/d1d6413c/27.webp"><p>刚刚我们提到的optimizer是优化器，它可以通过计算得到的梯度自动更新网络的权重。</p><img src="/d1d6413c/28.webp"><p>Adam和SGD是两个非常常用的优化器。</p><img src="/d1d6413c/29.webp"><p>另外优化器有一个额外的参数————学习速率（Learning Rate），它会影响每次权重变化的大小。</p><p>学习率越大，神经网络权重的变化量就越大，但学习率绝不是越大越好，过大的学习率会让loss无法收敛，甚至可能出现随着训练增大的情况。</p><img src="/d1d6413c/30.webp"><p>学习率设置的过小会降低训练的速度，甚至可能让你的神经网络学不到任何东西。</p><img src="/d1d6413c/31.webp"><p>当然也有人尝试使用动态的学习率，比如随着训练的推进逐渐降低学习率。关于学习率和优化器的选择又是一个很宽泛的话题，这里就不展开讨论了。</p><p>另外在训练的过程中，我们可以将loss打印出来以方便我们跟踪模型的训练进度。这里我们还可以用到Tensorboard这个库，然后可以调用add_scalar()来绘制像loss、精确度这样标量的数据，命令行调用tensorboard –logdir&#x3D;runs可查看。</p><img src="/d1d6413c/32.webp"><p>这一步不是必要的，但是图表呈现的信息往往比数字要直观很多。</p><img src="/d1d6413c/33.webp"><hr><h3 id="模型评估（Model-Evaluation）"><a href="#模型评估（Model-Evaluation）" class="headerlink" title="模型评估（Model Evaluation）"></a>模型评估（Model Evaluation）</h3><p>我们将数据分成了训练和测试两部分，通过我们会预留少量的数据做评估，这一部分数据并不会拿来做训练。</p><img src="/d1d6413c/34.webp"><p>评估的代码和训练非常相似，除了我们不会计算梯度来更新网络的权重。我们同样会输出一个loss，然后观察这个loss下降的情况，因为单纯训练loss的降低并不能代表模型表现得很好，模型也有可能过度拟合（Overfit）我们的训练数据，也就是说我们的模型对于训练数据表现得很好，但是对于从没有见过的数据却表现得很差。</p><img src="/d1d6413c/35.webp"><p>为了避免这种情况，我们会同时关注训练和评估时候的loss以及精确度这些指标。</p><img src="/d1d6413c/36.webp"><hr><h3 id="最基本的验证（Sanity-Check）"><a href="#最基本的验证（Sanity-Check）" class="headerlink" title="最基本的验证（Sanity Check）"></a>最基本的验证（Sanity Check）</h3><p>在真正训练之前，我们最好对之前的代码做一个最最基本的验证，因为训练一个模型通常会花很多时间，有时候一两天都有可能，如果等你训练完了才发现模型根本不工作，那一定让人气到原地升天。</p><p>so how to do?</p><p>比如我们可以修改这里的dataloader，让我们暂时只用第一个batch的数据，并且我们只用batch中的前两个样本来做训练。</p><img src="/d1d6413c/37.webp"> <img src="/d1d6413c/38.webp"><p>如果在这种情况下loss都不会降低，也就是说我们的模型都不能过拟合，那么我们的代码肯定哪里有问题，需要进行调试。</p><hr><h3 id="真正的模型训练（Model-Training）"><a href="#真正的模型训练（Model-Training）" class="headerlink" title="真正的模型训练（Model Training）"></a>真正的模型训练（Model Training）</h3><p>在训练的过程中，我们还可以每隔一段时间，让目前的模型生成一段输出，这一步主要是为了实时观测模型的预测结果，may大be可以看到我们模型的输出随着训练有显著的提升。</p><p>我们还可以做一些改进，比如使用两层的lstm单元，并在输出之前额外增加了一个线性层。与之前的模型相比较，新的模型进一步降低了loss并提高了预测的准确度。</p><p>虽然不是每一个修改都能保证模型效果的提升，不过模型优化确实需要我们不断地进行尝试，通常我们在loss不再降低的时候就可以停止训练了（需要同时观察validation loss而不单单是training loss）。</p><hr><h3 id="推断（Inference）"><a href="#推断（Inference）" class="headerlink" title="推断（Inference）"></a>推断（Inference）</h3><p>生成歌词的generate()函数稍微有点长，不过总体来说，它会将我们规定的首字符先传递给神经网络，然后让神经网络自由创作，直到这一句结束（遇到“&#x2F;”分隔符为止）。</p><img src="/d1d6413c/39.webp"><p>这里的next_word函数会将当前字符传入神经网络然后返回预测的下一个字，中间也会维护一个隐藏状态hidden</p><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本文也只不过提到了深度学习的冰山一角，像图像、声音、语言处理等等，每一个子领域都有太多东西值得去推敲，每年也会看到很多新的突破。</p><p>要训练一个好的模型绝对不是一件轻松的事情，有时候对模型结构的一点点修改，甚至是对（超）参数（hyper parameter）的一点点调整，都有可能带来很大的性能提升。</p><hr><h3 id="参考与鸣谢"><a href="#参考与鸣谢" class="headerlink" title="参考与鸣谢"></a>参考与鸣谢</h3><blockquote><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1oq4y1E7Vd">https://www.bilibili.com/video/BV1oq4y1E7Vd</a><br><a target="_blank" rel="noopener" href="https://github.com/rossning92/ai-lyrics-writing">https://github.com/rossning92/ai-lyrics-writing</a></p></blockquote></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/fb046b32.html" rel="prev" title="跟李沐学AI-读论文-AlexNet 论文逐段精读"><i class="fa fa-chevron-left"></i> 跟李沐学AI-读论文-AlexNet 论文逐段精读</a></div><div class="post-nav-item"><a href="/4f387357.html" rel="next" title="学习报告：基于单通道EEG-SSVEP的BCI的机械臂控制">学习报告：基于单通道EEG-SSVEP的BCI的机械臂控制 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments["activeClass"];var e;(t=CONFIG.comments.storage?localStorage.getItem("comments_active")||t:t)&&(e=document.querySelector(`a[href="#comment-${t}"]`))&&e.click()}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85PyTorch"><span class="nav-number">2.</span> <span class="nav-text">安装PyTorch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%EF%BC%88Dataset%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">数据集（Dataset）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B%EF%BC%88Build-Model%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">创建模型（Build Model）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83%EF%BC%88Training%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">训练（Training）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%EF%BC%88Model-Evaluation%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">模型评估（Model Evaluation）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E9%AA%8C%E8%AF%81%EF%BC%88Sanity-Check%EF%BC%89"><span class="nav-number">7.</span> <span class="nav-text">最基本的验证（Sanity Check）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%9F%E6%AD%A3%E7%9A%84%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%EF%BC%88Model-Training%EF%BC%89"><span class="nav-number">8.</span> <span class="nav-text">真正的模型训练（Model Training）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E6%96%AD%EF%BC%88Inference%EF%BC%89"><span class="nav-number">9.</span> <span class="nav-text">推断（Inference）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">10.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E4%B8%8E%E9%B8%A3%E8%B0%A2"><span class="nav-number">11.</span> <span class="nav-text">参考与鸣谢</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Aisaka Aoi" src="/images/manatsu.jpg"><p class="site-author-name" itemprop="name">Aisaka Aoi</p><div class="site-description" itemprop="description">逢坂葵的个人博客</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">864</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">50</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/AisakaAoi" title="GitHub 👨‍💻 → https:&#x2F;&#x2F;github.com&#x2F;AisakaAoi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub 👨‍💻</a> </span><span class="links-of-author-item"><a href="https://github.com/AisakaManatsu" title="GitHub 👩‍💻 → https:&#x2F;&#x2F;github.com&#x2F;AisakaManatsu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub 👩‍💻</a> </span><span class="links-of-author-item"><a href="mailto:chenzongnan@m.scnu.edu.cn" title="E-Mail 🏫 → mailto:chenzongnan@m.scnu.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail 🏫</a> </span><span class="links-of-author-item"><a href="mailto:aisakaaoi@qq.com" title="E-Mail 📧 → mailto:aisakaaoi@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail 📧</a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/91560309" title="Bilibili 📺 → https:&#x2F;&#x2F;space.bilibili.com&#x2F;91560309" rel="noopener" target="_blank"><i class="fab fa-bilibili fa-fw"></i>Bilibili 📺</a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/198562921" title="Bilibili 🎮 → https:&#x2F;&#x2F;space.bilibili.com&#x2F;198562921" rel="noopener" target="_blank"><i class="fab fa-bilibili fa-fw"></i>Bilibili 🎮</a> </span><span class="links-of-author-item"><a href="https://www.youtube.com/channel/UCALvyn5Cl76GCotO9pczvjg" title="YouTube 📺 → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCALvyn5Cl76GCotO9pczvjg" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube 📺</a></span></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Aisaka Aoi</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">2.7m</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">112:21</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&"),r="/lib/pdf/web/viewer.html?file="+encodeURIComponent(t)+a;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script>NexT.utils.loadComments(document.querySelector("#valine-comments"),()=>{NexT.utils.getScript("//unpkg.com/valine/dist/Valine.min.js",()=>{var i=["nick","mail","link"],e="nick,mail,link".split(",").filter(e=>i.includes(e));new Valine({el:"#valine-comments",verify:!0,notify:!0,appId:"UqjWdRYbIUEUQRXhBUUIh1QE-gzGzoHsz",appKey:"gj89JXC485PFbpdHLKVkz6dm",placeholder:"这里可以发送评论~（上面可以输入昵称、邮箱）",avatar:"mm",meta:e,pageSize:"10",visitor:!0,lang:"zh-cn",path:location.pathname,recordIP:!1,serverURLs:""})},window.Valine)})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/haru02.model.json"},display:{position:"right",width:208,height:520},mobile:{show:!1},log:!1})</script></body></html>