<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><meta name="baidu-site-verification" content="code-KCMz4b3cnd"><meta name="google-site-verification" content="MTp8U7dJ1uzrfz8Mu6rgqX1CIm3HjqPWd0xaRcv1tFg"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/favicon.png" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"aisakaaoi.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!1,nav:null,activeClass:"valine"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="æ‹¼æ¥ä¸‹å›¾æ˜¯pcmæ•°æ®çš„å‚¨å­˜ï¼š   å°†ä¸¤ä¸ªpcmæ•°æ®è¿›è¡Œåˆå¹¶åªéœ€å°†è¿™ä¸¤ä¸ªpcmæ•°æ®ç›´æ¥è¿ç»­å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å°±èƒ½å¤Ÿè·å¾—ä¸€ä¸ªæ‹¼æ¥å¥½çš„æ•°æ®ã€‚è¦æ³¨æ„çš„æ˜¯è¦æ§åˆ¶å¥½å†™å…¥çš„bufferå¤§å°è¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®å†™å…¥çš„é€Ÿåº¦ï¼ˆä¾‹å¦‚1kbï¼‰"><meta property="og:type" content="article"><meta property="og:title" content="Android-éŸ³è§†é¢‘-éŸ³é¢‘å¼€å‘-ï¼ˆå››ï¼‰éŸ³é¢‘å¤„ç†"><meta property="og:url" content="https://aisakaaoi.github.io/555ed0ac.html"><meta property="og:site_name" content="é€¢å‚è‘µçš„ä¸ªäººåšå®¢"><meta property="og:description" content="æ‹¼æ¥ä¸‹å›¾æ˜¯pcmæ•°æ®çš„å‚¨å­˜ï¼š   å°†ä¸¤ä¸ªpcmæ•°æ®è¿›è¡Œåˆå¹¶åªéœ€å°†è¿™ä¸¤ä¸ªpcmæ•°æ®ç›´æ¥è¿ç»­å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å°±èƒ½å¤Ÿè·å¾—ä¸€ä¸ªæ‹¼æ¥å¥½çš„æ•°æ®ã€‚è¦æ³¨æ„çš„æ˜¯è¦æ§åˆ¶å¥½å†™å…¥çš„bufferå¤§å°è¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®å†™å…¥çš„é€Ÿåº¦ï¼ˆä¾‹å¦‚1kbï¼‰"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://aisakaaoi.github.io/555ed0ac/1.webp"><meta property="og:image" content="https://aisakaaoi.github.io/555ed0ac/2.webp"><meta property="og:image" content="https://aisakaaoi.github.io/555ed0ac/3.webp"><meta property="article:published_time" content="2021-09-25T08:07:20.000Z"><meta property="article:modified_time" content="2026-01-23T11:02:36.854Z"><meta property="article:author" content="Aisaka Aoi"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://aisakaaoi.github.io/555ed0ac/1.webp"><link rel="canonical" href="https://aisakaaoi.github.io/555ed0ac.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Android-éŸ³è§†é¢‘-éŸ³é¢‘å¼€å‘-ï¼ˆå››ï¼‰éŸ³é¢‘å¤„ç† | é€¢å‚è‘µçš„ä¸ªäººåšå®¢</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?7308ed05421777c301eefa3754da1b42",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="é€¢å‚è‘µçš„ä¸ªäººåšå®¢" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">aoiå­¦é™¢</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Aisaka's Blog, School of Aoi, Aisaka University</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»<span class="badge">20</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£<span class="badge">1020</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="æœç´¢..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><a href="https://github.com/AisakaAoi" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://aisakaaoi.github.io/555ed0ac.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/manatsu.jpg"><meta itemprop="name" content="Aisaka Aoi"><meta itemprop="description" content="Aisaka's Blog, School of Aoi, Aisaka University"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="é€¢å‚è‘µçš„ä¸ªäººåšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Android-éŸ³è§†é¢‘-éŸ³é¢‘å¼€å‘-ï¼ˆå››ï¼‰éŸ³é¢‘å¤„ç†</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-25 16:07:20" itemprop="dateCreated datePublished" datetime="2021-09-25T16:07:20+08:00">2021-09-25</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">åˆ†ç±»äº</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%F0%9F%8C%99%E9%80%A2%E5%9D%82%E6%9D%82%E8%B0%88%E4%B8%8E%E6%90%AC%E8%BF%90/" itemprop="url" rel="index"><span itemprop="name">ğŸŒ™é€¢å‚æ‚è°ˆä¸æ¬è¿</span></a> </span>ï¼Œ <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%F0%9F%8C%99%E9%80%A2%E5%9D%82%E6%9D%82%E8%B0%88%E4%B8%8E%E6%90%AC%E8%BF%90/%E2%AD%90%E4%B8%80%E4%BA%9B%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">â­ä¸€äº›æŠ€æœ¯</span></a> </span></span><span id="/555ed0ac.html" class="post-meta-item leancloud_visitors" data-flag-title="Android-éŸ³è§†é¢‘-éŸ³é¢‘å¼€å‘-ï¼ˆå››ï¼‰éŸ³é¢‘å¤„ç†" title="é˜…è¯»æ¬¡æ•°"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valineï¼š</span> <a title="valine" href="/555ed0ac.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/555ed0ac.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="æœ¬æ–‡å­—æ•°"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span> <span>16k</span> </span><span class="post-meta-item" title="é˜…è¯»æ—¶é•¿"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span> <span>40 åˆ†é’Ÿ</span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="æ‹¼æ¥"><a href="#æ‹¼æ¥" class="headerlink" title="æ‹¼æ¥"></a>æ‹¼æ¥</h3><p>ä¸‹å›¾æ˜¯pcmæ•°æ®çš„å‚¨å­˜ï¼š</p><img src="/555ed0ac/1.webp"><p>å°†ä¸¤ä¸ªpcmæ•°æ®è¿›è¡Œåˆå¹¶åªéœ€å°†è¿™ä¸¤ä¸ªpcmæ•°æ®ç›´æ¥è¿ç»­å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å°±èƒ½å¤Ÿè·å¾—ä¸€ä¸ªæ‹¼æ¥å¥½çš„æ•°æ®ã€‚è¦æ³¨æ„çš„æ˜¯è¦æ§åˆ¶å¥½å†™å…¥çš„bufferå¤§å°è¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®å†™å…¥çš„é€Ÿåº¦ï¼ˆä¾‹å¦‚1kbï¼‰</p><span id="more"></span><p>éŸ³é¢‘æ‹¼æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataInputStream</span> <span class="variable">ins1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file1.file)));</span><br><span class="line"><span class="type">DataInputStream</span> <span class="variable">ins2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file2.file)));</span><br><span class="line"><span class="type">DataOutputStream</span> <span class="variable">outputStream</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(<span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file)));</span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="type">byte</span>[] bytes2 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="type">boolean</span> isfinish1= <span class="literal">false</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">isfinish2</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span>(!isfinish1)&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> ins1.read(bytes);</span><br><span class="line">    <span class="keyword">if</span>(temp &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        isfinish1 = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        outputStream.write(bytes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(!isfinish2)&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> ins2.read(bytes2);</span><br><span class="line">    <span class="keyword">if</span>(temp &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        isfinish2 = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        outputStream.write(bytes2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ins1.close();</span><br><span class="line">ins2.close();</span><br><span class="line">outputStream.close();</span><br></pre></td></tr></table></figure><hr><h3 id="è£å‰ª"><a href="#è£å‰ª" class="headerlink" title="è£å‰ª"></a>è£å‰ª</h3><p>å‰ªpcmå’Œæ‹¼æ¥pcmç›¸ä¼¼ï¼Œä¸€ä¸ªæ˜¯å°†ä¸¤ä¸ªæ–‡ä»¶å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶ä¸­çš„ä¸€æ®µå†™å…¥å¦å¤–ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¿™é‡Œä¸»è¦çš„é—®é¢˜æ˜¯å¦‚ä½•ç¡®å®šæ•°æ®æ‰€è¡¨æ˜çš„æ—¶é—´ç‚¹ã€‚</p><p>è¿™é‡Œè¦ç»è¿‡è®¡ç®—è·å¾—å¼€å§‹å†™å…¥å’Œç»“æŸå†™å…¥çš„æ•°æ®ä½ç½®ï¼Œç»è¿‡é‡‡æ ·ç‡ã€å£°é“æ•°å’Œæ¯”ç‰¹æ•°æ¥è·å¾—æ¯ç§’çš„æ•°æ®é‡ã€‚</p><p>æ¯ç§’æ•°æ®é‡ &#x3D; é‡‡æ ·ç‡ âˆ— å£°é“æ•° âˆ— æ¯”ç‰¹æ•° &#x2F; 1000 &#x2F; 8</p><p>éŸ³é¢‘è£å‰ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(source.file)));</span><br><span class="line"><span class="type">DataOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(<span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file)));</span><br><span class="line"><span class="type">int</span> <span class="variable">audioFormat</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(source.bit_num == <span class="number">16</span>)&#123;</span><br><span class="line">    audioFormat = AudioFormat.ENCODING_PCM_16BIT;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    audioFormat = AudioFormat.ENCODING_PCM_8BIT;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">bufferSize</span> <span class="operator">=</span> AudioRecord.getMinBufferSize(source.sample_rage_hz,source.channel,audioFormat);</span><br><span class="line"><span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[bufferSize * <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">sample</span> <span class="operator">=</span> source.getSampleNuit();</span><br><span class="line"><span class="keyword">while</span>(start &lt; end)&#123;</span><br><span class="line">    inputStream.read(buffer,<span class="number">0</span>,buffer.length);</span><br><span class="line">    outputStream.write(buffer, <span class="number">0</span>, buffer.length);</span><br><span class="line">    start = (bufferSize * <span class="number">2</span> + start * sample) / sample;</span><br><span class="line">&#125;</span><br><span class="line">inputStream.close();</span><br><span class="line">outputStream.close();</span><br></pre></td></tr></table></figure><hr><h3 id="æ··éŸ³"><a href="#æ··éŸ³" class="headerlink" title="æ··éŸ³"></a>æ··éŸ³</h3><h4 id="çº¿æ€§å åŠ åæ±‚å¹³å‡"><a href="#çº¿æ€§å åŠ åæ±‚å¹³å‡" class="headerlink" title="çº¿æ€§å åŠ åæ±‚å¹³å‡"></a>çº¿æ€§å åŠ åæ±‚å¹³å‡</h4><p>å¯¹äºpcmçš„æ··éŸ³åŸç†æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ•°æ®çš„åŠ å’Œï¼Œå¯æ˜¯ä¸ä¸€æ ·åŠ å’Œè·å¾—çš„æ•ˆæœæ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚æ­¤æ ·ä¾‹å°±æ˜¯ç”¨äº†æœ€ç®€å•çš„çº¿æ€§å åŠ åæ±‚å¹³å‡ã€‚å°±æ˜¯ä¸¤ä¸ªpcmæ–‡ä»¶å¯¹åº”çš„æ•°å€¼å‘åŠ é™¤ä»¥2ï¼Œå›ºç„¶ä¸ºäº†èƒ½å¤Ÿè°ƒèŠ‚è¿™ä¸¤ä¸ªéŸ³é¢‘å£°éŸ³å¤§å°ï¼Œèƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ•°æ®ä»¥å‰ä¹˜ä»¥ä¸€ä¸ªç³»æ•°ã€‚</p><p>æ•°æ®ç»“æœ &#x3D; [(pcmæ•°æ®1 âˆ— ç³»æ•°1) + (pcmæ•°æ®2 âˆ— ç³»æ•°2)] &#x2F; 2</p><p>ä¼˜åŠ¿ï¼šä¸ä¼šäº§ç”Ÿæº¢å‡ºï¼Œå™ªéŸ³è¾ƒå°</p><p>ç¼ºç‚¹ï¼šè¡°å‡è¿‡å¤§ï¼Œå½±å“è´¨é‡</p><p>è¿˜æœ‰å¤æ‚çš„æ–¹æ³•ï¼šä¾‹å¦‚å½’ä¸€åŒ–æ··éŸ³å’Œä»æ–°é‡‡æ ·æ³•ç­‰ã€‚</p><p>éŸ³é¢‘æ··éŸ³â€”â€”â€”â€”çº¿æ€§å åŠ åæ±‚å¹³å‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">byte</span> <span class="title function_">remixAVG</span><span class="params">(<span class="type">byte</span> buffer1, <span class="type">byte</span> buffer2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> (buffer1 + buffer2) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">byte</span>) value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å½’ä¸€åŒ–æ··éŸ³ï¼ˆè‡ªé€‚åº”åŠ æƒæ··éŸ³ç®—æ³•ï¼‰"><a href="#å½’ä¸€åŒ–æ··éŸ³ï¼ˆè‡ªé€‚åº”åŠ æƒæ··éŸ³ç®—æ³•ï¼‰" class="headerlink" title="å½’ä¸€åŒ–æ··éŸ³ï¼ˆè‡ªé€‚åº”åŠ æƒæ··éŸ³ç®—æ³•ï¼‰"></a>å½’ä¸€åŒ–æ··éŸ³ï¼ˆè‡ªé€‚åº”åŠ æƒæ··éŸ³ç®—æ³•ï¼‰</h4><p>ä½¿ç”¨æ›´å¤šçš„ä½æ•°ï¼ˆ32 bitï¼‰æ¥è¡¨ç¤ºéŸ³é¢‘æ•°æ®çš„ä¸€ä¸ªæ ·æœ¬ï¼Œæ··å®ŒéŸ³ååœ¨æƒ³åŠæ³•ä¸‹é™å…¶æŒ¯å¹…ï¼Œä½¿å…¶ä»æ—§åˆ†å¸ƒåœ¨16 bitæ‰€èƒ½è¡¨ç¤ºçš„èŒƒå›´ä»¥å†…ã€‚</p><p>ä¸ºé¿å…å‘ç”Ÿæº¢å‡ºï¼Œä½¿ç”¨ä¸€ä¸ªå¯å˜çš„è¡°å‡å› å­å¯¹è¯­éŸ³è¿›è¡Œè¡°å‡ã€‚è¿™ä¸ªè¡°å‡å› å­ä¹Ÿå°±è¡¨æ˜è¯­éŸ³çš„æƒé‡ï¼Œè¡°å‡å› å­éšç€éŸ³é¢‘æ•°æ®çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå› æ­¤ç§°ä¸ºè‡ªé€‚åº”åŠ æƒæ··éŸ³ã€‚å½“æº¢å‡ºæ—¶ï¼Œè¡°å‡å› å­è¾ƒå°ï¼Œä½¿å¾—æº¢å‡ºçš„æ•°æ®åœ¨è¡°å‡åå¯ä»¥å¤„äºä¸´ç•Œå€¼ä¹‹å†…ï¼Œè€Œåœ¨æ²¡æœ‰æº¢å‡ºæ—¶ï¼Œåˆè®©è¡°å‡å› å­æ…¢æ…¢å¢å¤§ï¼Œä½¿æ•°æ®è¾ƒä¸ºå¹³ç¼“çš„å˜åŒ–ã€‚</p><p>åŸºæœ¬å…¬å¼æ˜¯ï¼šC &#x3D; A + B - A<em>B &#x2F; (æ•°æ®ç±»å‹çš„æœ€å¤§å€¼)ï¼ˆbyteæ•°æ®å°±æ˜¯ï¼šC &#x3D; A + B - A</em>B &#x2F; 127; shortæ•°æ®å°±æ˜¯ï¼šC &#x3D; A + B - A * B &#x2F; 32767;ï¼‰</p><p>éŸ³é¢‘æ··éŸ³â€”â€”å½’ä¸€åŒ–æ··éŸ³ï¼ˆè‡ªé€‚åº”åŠ æƒæ··éŸ³ç®—æ³•ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">short</span> <span class="title function_">remixNOR</span><span class="params">(<span class="type">short</span> buffer1, <span class="type">short</span> buffer2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="keyword">if</span> (buffer1 &lt; <span class="number">0</span> &amp;&amp; buffer2 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        value = (<span class="type">int</span>) (buffer1 + buffer2 - buffer1 * buffer2 / (-(Math.pow(<span class="number">2</span>,<span class="number">16</span>-<span class="number">1</span>)-<span class="number">1</span>)));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        value = (<span class="type">int</span>) (buffer1 + buffer2 - buffer1 * buffer2 / (Math.pow(<span class="number">2</span>,<span class="number">16</span>-<span class="number">1</span>)-<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">short</span>) value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="é™å™ª"><a href="#é™å™ª" class="headerlink" title="é™å™ª"></a>é™å™ª</h3><h4 id="å¸¸è§çš„å¼€æºé™å™ªæ–¹æ¡ˆ"><a href="#å¸¸è§çš„å¼€æºé™å™ªæ–¹æ¡ˆ" class="headerlink" title="å¸¸è§çš„å¼€æºé™å™ªæ–¹æ¡ˆ"></a>å¸¸è§çš„å¼€æºé™å™ªæ–¹æ¡ˆ</h4><p>Speexï¼šSpeexæ˜¯ä¸€å¥—ä¸»è¦é’ˆå¯¹è¯­éŸ³çš„å¼€æºå…è´¹ï¼Œæ— ä¸“åˆ©ä¿æŠ¤çš„åº”ç”¨é›†åˆï¼Œå®ƒä¸ä»…åŒ…æ‹¬ç¼–è§£ç å™¨ï¼Œè¿˜åŒ…æ‹¬VAD(è¯­éŸ³æ£€æµ‹)ã€DTX(ä¸è¿ç»­ä¼ è¾“)ã€AEC(å›å£°æ¶ˆé™¤)ã€NS(å»å™ª)ç­‰å®ç”¨æ¨¡å—ã€‚</p><p>RNNoiseï¼šRNNoiseé™å™ªç®—æ³•æ˜¯æ ¹æ®çº¯è¯­éŸ³ä»¥åŠå™ªå£°é€šè¿‡GRUè®­ç»ƒæ¥åšã€‚åŒ…å«ç‰¹å¾ç‚¹æå–ã€é¢„æ–™ç­‰æ ¸å¿ƒéƒ¨åˆ†ã€‚</p><p>WebRTCï¼šWebRTCæä¾›äº†è§†é¢‘ä¼šè®®çš„æ ¸å¿ƒæŠ€æœ¯ï¼ŒåŒ…æ‹¬éŸ³è§†é¢‘çš„é‡‡é›†ã€ç¼–è§£ç ã€ç½‘ç»œä¼ è¾“ã€æ˜¾ç¤ºç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜æ”¯æŒè·¨å¹³å°ï¼šWindowsã€Linuxã€Macã€Androidã€‚ä½¿ç”¨çš„å°±æ˜¯WebRTCçš„éŸ³é¢‘å¤„ç†æ¨¡å—audio_processing</p><h4 id="RNNoiseé™å™ªæ–¹æ¡ˆ"><a href="#RNNoiseé™å™ªæ–¹æ¡ˆ" class="headerlink" title="RNNoiseé™å™ªæ–¹æ¡ˆ"></a>RNNoiseé™å™ªæ–¹æ¡ˆ</h4><p>ä¼ ç»Ÿé™å™ªç®—æ³•å¤§éƒ¨åˆ†æ˜¯ä¼°è®¡å™ªå£°+ç»´çº³æ»¤æ³¢ï¼Œå™ªå£°ä¼°è®¡çš„å‡†ç¡®æ€§æ˜¯æ•´ä¸ªç®—æ³•æ•ˆæœçš„æ ¸å¿ƒã€‚æ ¹æ®å™ªå£°çš„ä¸åŒå¤§éƒ¨åˆ†å¤„ç†æ˜¯é’ˆå¯¹å¹³ç¨³å™ªå£°ä»¥åŠç¬æ—¶å™ªå£°æ¥åšã€‚</p><p>RNNoiseçš„ä¼˜ç‚¹ä¸»è¦æ˜¯ä¸€ä¸ªç®—æ³•é€šè¿‡è®­ç»ƒå¯ä»¥è§£å†³æ‰€æœ‰å™ªå£°åœºæ™¯ä»¥åŠå¯ä»¥ä¼˜åŒ–ä¼ ç»Ÿå™ªå£°ä¼°è®¡çš„æ—¶å»¶å’Œæ”¶æ•›é—®é¢˜ã€‚</p><p>RNNoiseçš„ç¼ºç‚¹æ˜¯æ·±åº¦å­¦ä¹ ç®—æ³•è½åœ°é—®é¢˜ã€‚å› ä¸ºç›¸å¯¹å¤§éƒ¨åˆ†ä¼ ç»Ÿç®—æ³•ï¼ŒRNNoiseè®­ç»ƒè¦å¾—åˆ°ä¸€ä¸ªå¾ˆå¥½çš„æ•ˆæœï¼Œç”±äºç‰¹å¾ç‚¹ä¸ªæ•°ã€éšè—å•å…ƒçš„ä¸ªæ•°ä»¥åŠç¥ç»ç½‘ç»œå±‚æ•°çš„å¢åŠ ï¼Œå¯¼è‡´æ¨¡å‹å¢å¤§ï¼Œè¿è¡Œæ•ˆç‡ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒRNNoiseå¤„ç†ä¹‹åçš„æ•°æ®æ›´å¹²å‡€äº›ï¼Œå‡ ä¹æ²¡æœ‰ç”µæµéŸ³å’Œæ‚éŸ³ï¼Œä½†æ˜¯å—é™äºè®­ç»ƒé›†ã€ç‰¹å¾ç‚¹é—®é¢˜ï¼Œåœ¨å¤„ç†ä¸€äº›æ•°æ®æ—¶å€™ä¼šæŠŠæ­£å¸¸çš„åŸå£°æ•°æ®ä¸€å¹¶é”™è¯¯å¤„ç†æ‰ã€‚</p><ul><li><p>RNNoiseçš„ä»£ç æ˜¯åŸºäºCå¼€æºçš„ï¼Œé›†æˆåˆ°Androidä¸­éœ€è¦ä½¿ç”¨NDKã€‚å¼€æºä»£ç ä¸­çš„rnn_data.cå’Œrnn_data.hæ˜¯é€šè¿‡æœºå™¨å­¦ä¹ è®­ç»ƒå‡ºæ¥çš„ï¼Œä¸æ˜¯é€šç”¨çš„ã€‚</p></li><li><p>å¼€æºé¡¹ç›®æä¾›çš„ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œä½†æ˜¯è¯¥æ–¹æ³•æ˜¯é’ˆå¯¹æ–‡ä»¶å¤„ç†çš„ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå¸¦å™ªéŸ³çš„PCMæ–‡ä»¶å¤„ç†æˆæ— å™ªéŸ³æ–‡ä»¶ã€‚ç›´æ’­SDKä¸­çš„éŸ³é¢‘æ•°æ®æ˜¯åˆ†æ®µçš„byteæ•°ç»„æ•°æ®ï¼Œæ‰€ä»¥ä¸­é—´éœ€è¦æ·»åŠ ä¸€äº›æ¥å£æ¥è®©RNNoiseæ¥æ”¯æŒåˆ†æ®µæ•°æ®çš„é™å™ªå¤„ç†ã€‚</p></li><li><p>æ ¹æ®RNNoiseçš„é™å™ªè¿‡ç¨‹å’Œä¸šåŠ¡æ¥å£æµç¨‹ï¼ŒæŠŠæ¥å£å®šä¹‰æˆinitã€processã€freeä¸‰ä¸ªæ¥å£ã€‚</p></li><li><p>åœ¨processæ•°æ®æ—¶å‘ç°RNNosieçš„å¤„ç†çª—å£å¤§å°æ˜¯480ï¼Œæ‰€ä»¥ä¼ å…¥çš„æ•°æ®ä¹Ÿå¿…é¡»æ˜¯480çš„æ­£æ•´æ•°å€ã€‚å¦‚æœä¸æ˜¯çš„è¯å¤„ç†ä¹‹åä¼šæœ‰æ˜æ˜¾çš„æ–°å¼•å…¥å™ªéŸ³ã€‚</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> FRAME_SIZE_SHIFT 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FRAME_SIZE (120&lt;&lt;FRAME_SIZE_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WINDOW_SIZE (2*FRAME_SIZE)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// å¯å¼ºåˆ¶ä¿®æ”¹FRAME_SIZEå¤§å°#define FRAME_SIZE (128&lt;&lt;FRAME_SIZE_SHIFT)</span></span><br></pre></td></tr></table></figure><ul><li>å¼€æºä»£ç ä¸­çš„rnn_data.cå’Œrnn_data.hæ˜¯é€šè¿‡æœºå™¨å­¦ä¹ è®­ç»ƒå‡ºæ¥çš„ï¼Œä¸æ˜¯é€šç”¨çš„ã€‚åœ¨å¤„ç†ä¸€ä¸ªå™ªéŸ³æ•°æ®æ—¶å‘ç°æœ‰äº›æ•°æ®ä¸­çš„åŸå£°ä¹Ÿä¼šä¸€å¹¶å¤„ç†æ‰ï¼Œè¿™ä¸ªæ•ˆæœå¦‚æœä¸é€šè¿‡æ–°çš„æ•°æ®é›†è®­ç»ƒé‚£ä¹ˆé™å™ªä¹‹åçš„æ•°æ®æ˜¯ä¸å¯ç”¨çš„ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*This file is automatically generated from a Keras model*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> RNN_DATA_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RNN_DATA_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rnn.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INPUT_DENSE_SIZE 24</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> DenseLayer input_dense;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VAD_GRU_SIZE 24</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> GRULayer vad_gru;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NOISE_GRU_SIZE 48</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> GRULayer noise_gru;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DENOISE_GRU_SIZE 96</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> GRULayer denoise_gru;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DENOISE_OUTPUT_SIZE 22</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> DenseLayer denoise_output;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VAD_OUTPUT_SIZE 1</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> DenseLayer vad_output;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RNNState</span> &#123;</span><br><span class="line">    <span class="type">float</span> vad_gru_state[VAD_GRU_SIZE];</span><br><span class="line">    <span class="type">float</span> noise_gru_state[NOISE_GRU_SIZE];</span><br><span class="line">    <span class="type">float</span> denoise_gru_state[DENOISE_GRU_SIZE];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><ul><li>æœºå™¨å­¦ä¹ å’Œè®­ç»ƒæ˜¯RNNoiseçš„çµé­‚ï¼Œéœ€è¦ä¸šåŠ¡æ¥å…¥æ–¹æ ¹æ®è‡ªèº«çš„ä½¿ç”¨åœºæ™¯é€šè¿‡å¤§é‡çš„æ•°æ®é›†æ¥æ‰¾å‡ºæœ€åˆé€‚çš„å¤„ç†é›†ã€‚</li></ul><h4 id="WebRTCé™å™ªæ–¹æ¡ˆ"><a href="#WebRTCé™å™ªæ–¹æ¡ˆ" class="headerlink" title="WebRTCé™å™ªæ–¹æ¡ˆ"></a>WebRTCé™å™ªæ–¹æ¡ˆ</h4><ul><li><p>WebRTCçš„ä»£ç æ˜¯åŸºäºC++å¼€æºçš„ï¼Œé›†æˆåˆ°Androidä¸­éœ€è¦ä½¿ç”¨NDKã€‚</p></li><li><p>WebRTCåªèƒ½å¤„ç†ç‰¹å®šçš„é‡‡æ ·ç‡æ•°æ®ï¼š8000ã€16000ã€32000ã€44100ã€48000ï¼Œè¿™ä¸ªæ˜¯å…¶ä»£ç å†…éƒ¨æ˜¯å†™æ­»çš„ï¼Œéœ€è¦è‡ªå·±å®ç°éŸ³é¢‘é‡é‡‡æ ·æ¥æ»¡è¶³WebRTCçš„é™å™ªé‡‡æ ·ç‡éœ€æ±‚ã€‚</p></li><li><p>æ ¹æ®WebRTCçš„é™å™ªè¿‡ç¨‹å’Œä¸šåŠ¡æ¥å£æµç¨‹ï¼ŒæŠŠæ¥å£å®šä¹‰æˆinitã€processã€freeä¸‰ä¸ªæ¥å£ã€‚åŒºåˆ«RNNoiseçš„æ˜¯éœ€è¦åœ¨processä¸­åšå¢ç›Šå¤„ç†ï¼ŒWebRTCé™å™ªä¼šé™ä½æ•°æ®çš„å£°éŸ³å¤§å°ï¼Œé€šè¿‡å¢ç›Šç”¨æ¥è¡¥å……å£°éŸ³å¤§å°ã€‚</p></li><li><p>åœ¨processæ•°æ®æ—¶å‘ç°WebRTCçš„å¤„ç†çª—å£å¤§å°å¿…é¡»æ˜¯160æˆ–æ˜¯320ä¸ªbyteï¼Œæ ¹æ®é‡‡æ ·ç‡ä¸åŒçª—å£å¤§å°ä¸åŒã€‚è¿™ä¸ªå’Œå¤„ç†RNNoiseæ˜¯ä¸€è‡´éƒ½åªèƒ½ä¼ æ­£æ•´æ•°å€æ•°æ®ï¼Œè¦ä¸è¿˜æ˜¯ä¼šæ–°å¼•å…¥å™ªéŸ³æ•°æ®ã€‚</p></li><li><p>WebRTCçš„é™å™ªNSæ¨¡å—å’Œå¢ç›ŠAGCæ¨¡å—æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ºäº†ä¸€æ¬¡æ•°æ®å®Œæˆä¸¤ä¸ªè¿‡ç¨‹éœ€è¦ç»„åˆæ•°æ®ï¼Œè¾¹é™å™ªè¾¹å¢ç›Šï¼Œå‡å°‘å¤„ç†è€—æ—¶ã€‚</p></li></ul><p>è‡ªå®šä¹‰è°ƒç”¨WebRTCæš´éœ²çš„æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  åˆå§‹åŒ–é™å™ª</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initProccesor</span><span class="params">()</span>&#123;</span><br><span class="line">    mProcessor = <span class="keyword">new</span> <span class="title class_">WebrtcProcessor</span>();</span><br><span class="line">    mProcessor.init(frequency);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†éœ€è¦é™å™ªçš„éŸ³é¢‘æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">(<span class="type">byte</span>[] data)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(mProcessor != <span class="literal">null</span>)&#123;</span><br><span class="line">        mProcessor.processNoise(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†éœ€è¦é™å™ªçš„éŸ³é¢‘æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">(<span class="type">short</span>[] data)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(mProcessor != <span class="literal">null</span>)&#123;</span><br><span class="line">        mProcessor.processNoise(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡Šæ”¾é™å™ªèµ„æº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">releaseProcessor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(mProcessor != <span class="literal">null</span>)&#123;</span><br><span class="line">        mProcessor.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰é™å™ªç±»WebrtcProcessor.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.jni;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éŸ³é¢‘é™å™ªå¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebrtcProcessor</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åŠ è½½é™å™ªåº“</span></span><br><span class="line">            System.loadLibrary(<span class="string">&quot;webrtc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsatisfiedLinkError e) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;Couldn&#x27;t load lib:   - &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†é™å™ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processNoise</span><span class="params">(<span class="type">byte</span>[] data)</span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(data == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> <span class="variable">newDataLength</span> <span class="operator">=</span> data.length/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(data.length % <span class="number">2</span> == <span class="number">1</span>)&#123;</span><br><span class="line">            newDataLength += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//æ­¤å¤„æ˜¯å°†å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºshortæ•°æ®</span></span><br><span class="line">        <span class="type">short</span>[] newData = <span class="keyword">new</span> <span class="title class_">short</span>[newDataLength];</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;newDataLength; i++)&#123;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">high</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(<span class="number">2</span>*i &lt; data.length)&#123;</span><br><span class="line">                low = data[<span class="number">2</span>*i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>((<span class="number">2</span>*i+<span class="number">1</span>) &lt; data.length)&#123;</span><br><span class="line">                high = data[<span class="number">2</span>*i+<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            newData[i] = (<span class="type">short</span>) (((high &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xff00</span>) | (low &amp; <span class="number">0x00ff</span>));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// äº¤ç»™åº•å±‚å¤„ç†</span></span><br><span class="line">        processNoise(newData);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//å¤„ç†å®Œä¹‹å, åˆå°†shortæ•°æ®è½¬æ¢ä¸ºå­—èŠ‚æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;newDataLength; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">2</span>*i &lt; data.length)&#123;</span><br><span class="line">                data[<span class="number">2</span>*i] = (<span class="type">byte</span>) (newData[i] &amp; <span class="number">0xff</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>((<span class="number">2</span>*i+<span class="number">1</span>) &lt; data.length)&#123;</span><br><span class="line">                data[<span class="number">2</span>*i+<span class="number">1</span>] = (<span class="type">byte</span>) ((newData[i] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–é™å™ªè®¾ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sampleRate é‡‡æ ·ç‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">init</span><span class="params">(<span class="type">int</span> sampleRate)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†é™å™ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">processNoise</span><span class="params">(<span class="type">short</span>[] data)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  é‡Šæ”¾é™å™ªèµ„æº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">()</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªä½¿ç”¨çš„è¯ä¸Šè¿°ä»£ç å·²è¶³å¤Ÿï¼Œä¸‹é¢ç¨å¾®çœ‹ä¸€ä¸‹æºç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;audio_ns.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;noise_suppression.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ­¤å¤„æ˜¯ä¸ºäº†é‡Œé¢çš„åº•å±‚æ–¹æ³•èƒ½è¢«javaå±‚è¯†åˆ«</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//é™å™ªçš„å®ä¾‹,å¥æŸ„</span></span><br><span class="line">    NsHandle* handle = <span class="literal">NULL</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//é™å™ªå¤„ç†</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">innerProcess</span><span class="params">(<span class="type">short</span> in_sample[], <span class="type">short</span> out_sample[], <span class="type">int</span> length)</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> curPosition = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//æ­¤å¤„ä»¥80ä¸ºå•ä½, ä¾æ¬¡è°ƒç”¨audio_ns_processå¤„ç†æ•°æ®,å› ä¸ºè¿™ä¸ªæ–¹æ³•ä¸€æ¬¡åªèƒ½å¤„ç†80ä¸ªshortéŸ³é¢‘æ•°æ®</span></span><br><span class="line">        <span class="keyword">while</span>(curPosition &lt; length)&#123;</span><br><span class="line">            <span class="built_in">audio_ns_process</span>((<span class="type">int</span>) handle, in_sample + curPosition, out_sample + curPosition);</span><br><span class="line">            curPosition += <span class="number">80</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">JNIEXPORT jboolean JNICALL</span></span><br><span class="line"><span class="function">    <span class="title">Java_com_test_jni_WebrtcProcessor_init</span><span class="params">(JNIEnv *env, jobject instance, jint sample_rate)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–é™å™ªå®ä¾‹</span></span><br><span class="line">        handle = (NsHandle *) <span class="built_in">audio_ns_init</span>(sample_rate);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">JNIEXPORT jboolean JNICALL</span></span><br><span class="line"><span class="function">    <span class="title">Java_com_test_jni_WebrtcProcessor_processNoise</span><span class="params">(JNIEnv *env, jobject instance, jshortArray sample)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(!handle)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//è·å–æ•°æ®é•¿åº¦</span></span><br><span class="line">        jsize length = env-&gt;<span class="built_in">GetArrayLength</span>(sample);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//è½¬æ¢ä¸ºjshortæ•°ç»„</span></span><br><span class="line">        jshort *sam = env-&gt;<span class="built_in">GetShortArrayElements</span>(sample, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//å°†samçš„æ•°æ®å…¨éƒ¨å¤åˆ¶ç»™æ–°çš„in_sample</span></span><br><span class="line">        <span class="type">short</span> in_sample[length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;length; i++)&#123;</span><br><span class="line">            in_sample[i] = sam[i];</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//ä¼ å…¥in_sampleä½œä¸ºéœ€è¦å¤„ç†éŸ³é¢‘æ•°æ®, å¤„ç†ä¹‹åçš„æ•°æ®è¿”å›åˆ°samä¸­</span></span><br><span class="line">        <span class="built_in">innerProcess</span>(in_sample, sam, length);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//å°†samä¸­çš„æ•°æ®,å†è½¬æ¢å›sampleä¸­</span></span><br><span class="line">        env-&gt;<span class="built_in">ReleaseShortArrayElements</span>(sample, sam, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">JNIEXPORT <span class="type">void</span> JNICALL</span></span><br><span class="line"><span class="function">    <span class="title">Java_com_test_jni_WebrtcProcessor_release</span><span class="params">(JNIEnv *env, jobject instance)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é™å™ªèµ„æº</span></span><br><span class="line">        <span class="keyword">if</span>(handle)&#123;</span><br><span class="line">            <span class="built_in">audio_ns_destroy</span>((<span class="type">int</span>) handle);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å®é™…ä¸ŠWebRTCé™å™ªä¸€æ¬¡æ€§åªå¤„ç†äº†80ä¸ªshortæ•°æ®ï¼ˆåœ¨8000é‡‡æ ·ç‡ä¸­æ˜¯è¿™æ ·çš„ï¼‰ï¼Œæ„æ€å°±æ˜¯è¯´WebRTCæ¯æ¬¡åªèƒ½å¤„ç†10æ¯«ç§’ï¼Œ0.01ç§’çš„æ•°æ®ã€‚é‚£ä¹ˆä¾æ¬¡ç±»æ¨ï¼Œé’ˆå¯¹44100é‡‡æ ·ç‡çš„æ•°æ®å¤„ç†çš„è¯ï¼Œæ¯æ¬¡èƒ½å¤„ç†çš„æ•°æ®é•¿åº¦å°±åº”è¯¥æ˜¯441ä¸ªshortæ•°æ®äº†ã€‚</p><p>WebRTCçš„é™å™ªæ˜¯å¦‚ä½•åˆå§‹åŒ–å’Œå¤„ç†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;audio_ns.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;noise_suppression.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">audio_ns_init</span><span class="params">(<span class="type">int</span> sample_rate)</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    NsHandle* NS_instance;</span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    <span class="comment">//åˆ›å»ºWebRtcNså®ä¾‹</span></span><br><span class="line">    <span class="keyword">if</span> ((ret = <span class="built_in">WebRtcNs_Create</span>(&amp;NS_instance) )) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;WebRtcNs_Create failed with error code = %d&quot;</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–WebRtcNså®ä¾‹,æ­¤å¤„éœ€è¦æŒ‡å®šé‡‡æ ·,å‘Šè¯‰å®ƒä¸€æ¬¡å¯ä»¥å¤„ç†å¤šå°‘ä¸ªshortéŸ³é¢‘æ•°æ®,</span></span><br><span class="line">    <span class="comment">//å¦‚æœæ˜¯8000, åˆ™ä¸€æ¬¡å¯ä»¥å¤„ç†80,å¦‚æœæ˜¯44100, åˆ™ä¸€æ¬¡å¯ä»¥å¤„ç†441ä¸ª</span></span><br><span class="line">    <span class="comment">//ä¹Ÿå°±æ˜¯è¯´,ä¸€æ¬¡æ€§å¯ä»¥å¤„ç†10msæ—¶é—´çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> ((ret = <span class="built_in">WebRtcNs_Init</span>(NS_instance, sample_rate) )) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;WebRtcNs_Init failed with error code = %d&quot;</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//è®¾ç½®é™å™ªçš„åŠ›åº¦,0,1,2, 0æœ€å¼±,2æœ€å¼º</span></span><br><span class="line">    <span class="keyword">if</span> (( ret =  <span class="built_in">WebRtcNs_set_policy</span>(NS_instance, <span class="number">2</span>)))&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;WebRtcNs_set_policy failed with error code = %d&quot;</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int</span>)NS_instance;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">audio_ns_process</span><span class="params">(<span class="type">int</span> ns_handle ,  <span class="type">short</span> *src_audio_data ,<span class="type">short</span> *dest_audio_data)</span></span>&#123;</span><br><span class="line">    <span class="comment">//get handle</span></span><br><span class="line">    NsHandle* NS_instance = (NsHandle* )ns_handle;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//noise suppression</span></span><br><span class="line">    <span class="keyword">if</span>(</span><br><span class="line">        <span class="comment">//æ­¤å¤„è¿™ä¹ˆåš,æ˜¯å› ä¸º,çœŸæ­£çš„WebRtcNs_Process,ä¸€æ¬¡åªèƒ½å¤„ç†80ä¸ªshortséŸ³é¢‘æ•°æ®</span></span><br><span class="line">        <span class="built_in">WebRtcNs_Process</span>(NS_instance ,src_audio_data ,<span class="literal">NULL</span> ,dest_audio_data , <span class="literal">NULL</span>) ||</span><br><span class="line">        <span class="built_in">WebRtcNs_Process</span>(NS_instance ,&amp;src_audio_data[<span class="number">80</span>] ,<span class="literal">NULL</span> ,&amp;dest_audio_data[<span class="number">80</span>] , <span class="literal">NULL</span>) )&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;WebRtcNs_Process failed with error code = &quot;</span> );</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_ns_destroy</span><span class="params">(<span class="type">int</span> ns_handle)</span></span>&#123;</span><br><span class="line">    <span class="comment">//é‡Šæ”¾WebRtcNsèµ„æº</span></span><br><span class="line">    <span class="built_in">WebRtcNs_Free</span>((NsHandle *) ns_handle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„é™å™ªç»†èŠ‚åœ¨WebRtcNs_Process()å‡½æ•°ä¸­ï¼Œå…·ä½“ç®—æ³•ç»†èŠ‚ç¬”è€…æµ…å°è¾„æ­¢ï¼Œä¸‹è¿°ä»…ç®€è¿°æ€è·¯ï¼š</p><p>æŠŠå‰50å¸§çš„æ•°æ®æ‹¿æ¥æ„å»ºå™ªå£°æ¨¡å‹ï¼ŒæŠŠå‰200å¸§çš„ä¿¡å·å¼ºåº¦ç”¨æ¥è®¡ç®—å½’ä¸€åŒ–çš„é¢‘è°±å·®å€¼è®¡ç®—ã€‚æ ¹æ®è¿™ä¸¤ä¸ªæ¨¡å‹ä½¿ç”¨æ¦‚ç‡ç›®çš„å‡½æ•°æ¥è®¡ç®—å‡ºæ¯å¸§çš„ä¿¡å™ªæ¯”å¹¶åŒºåˆ†å‡ºå™ªå£°å’Œå£°éŸ³ï¼Œç„¶åæ ¹æ®è®¡ç®—å‡ºçš„ä¿¡å™ªæ¯”åœ¨é¢‘åŸŸä½¿ç”¨ç»´çº³æ»¤æ³¢å™¨å¯¹å™ªå£°ä¿¡å·è¿›è¡Œå™ªå£°æ¶ˆé™¤ï¼Œæœ€ååœ¨æ ¹æ®é™å™ªå‰åçš„èƒ½é‡æ¯”å’Œä¿¡å·å™ªå£°ä¼¼ç„¶æ¯”å¯¹é™å™ªåçš„æ•°æ®è¿›è¡Œä¿®å¤å’Œè°ƒæ•´åè¾“å‡ºã€‚</p><h4 id="ä¸¤ç§é™å™ªæ–¹æ¡ˆé›†æˆä¼˜ç¼ºç‚¹å¯¹æ¯”"><a href="#ä¸¤ç§é™å™ªæ–¹æ¡ˆé›†æˆä¼˜ç¼ºç‚¹å¯¹æ¯”" class="headerlink" title="ä¸¤ç§é™å™ªæ–¹æ¡ˆé›†æˆä¼˜ç¼ºç‚¹å¯¹æ¯”"></a>ä¸¤ç§é™å™ªæ–¹æ¡ˆé›†æˆä¼˜ç¼ºç‚¹å¯¹æ¯”</h4><p>ç›®å‰WebRTCæœ€æ–°ä»£ç åªæ”¯æŒé‡‡æ ·ç‡ä¸º8000ã€16000ã€32000ã€44100ã€48000çš„éŸ³é¢‘è¿›è¡Œé™å™ªï¼Œé’ˆå¯¹å…¶ä½™çš„é‡‡æ ·ç‡éœ€è¦è¿›è¡Œæ•°æ®é‡é‡‡æ ·åˆ°ä¸Šè¿°é‡‡æ ·ç‡ä¹‹åè¿›è¡Œé™å™ªï¼Œå¤„ç†å®Œæ¯•ä¹‹åéœ€è¦å†æ¬¡æ¢å¤åŸé‡‡æ ·ç‡ï¼›RNNoiseå¯¹é‡‡æ ·ç‡æ²¡æœ‰è¦æ±‚ï¼Œå¯ä»¥é€‚é…å¸¸è§çš„é‡‡æ ·ç‡ã€‚</p><p>WebRTCåœ¨é™å™ªä¹‹åè¿˜éœ€è¦å¯¹æ•°æ®è¿›è¡Œå¢ç›Šå¤„ç†ï¼Œä½†æ˜¯å¢ç›Šä¼šå¢å¤§ç”µæµéŸ³ï¼Œæ•ˆæœä¼šç¨å·®äº›ã€‚</p><p>WebRTCå¤„ç†æ•°æ®çš„bufferç›®å‰ä»£ç æ˜¯320çš„æ•´æ•°å€ï¼›RNNoiseå¤„ç†æ•°æ®çš„bufferç›®å‰ä»£ç æ˜¯480çš„æ•´æ•°å€ã€‚è¾“å…¥çš„bufferéœ€æ˜¯å›ºå®šå¤§å°çš„ï¼Œå¦‚æœä¸æ˜¯æ­£æ•´æ•°å€ï¼Œéœ€è¦å¤–éƒ¨åœ¨ä¼ å…¥æ—¶å¤„ç†ä¸‹ã€‚</p><p>ä»ä»£ç å¤æ‚åº¦çœ‹ï¼ŒWebRTCçš„ä»£ç æ˜¯å¤šäºRNNoiseä»£ç çš„ã€‚RNNoiseæ”¯æŒæœºå™¨å­¦ä¹ ï¼Œé€šè¿‡æœºå™¨å­¦ä¹ ç”Ÿæˆrnn_data.hå’Œrnn_data.cæ–‡ä»¶æ¥åŒ¹é…ä¸åŒçš„é™å™ªæ•ˆæœã€‚</p><p>é™å™ªè€—æ—¶å¯¹æ¯”ï¼ŒRNNoiseå¤„ç†3840å­—èŠ‚çš„bufferæ•°æ®è€—æ—¶å¤§æ¦‚åœ¨6mså·¦å³ï¼Œä½†åœ¨å¼€å§‹æ—¶è€—æ—¶åœ¨30mså·¦å³ï¼Œé€’å‡åˆ°6mså¹¶ç¨³å®šï¼›WebRTCå¤„ç†3840å­—èŠ‚çš„bufferæ•°æ®è€—æ—¶å¤§æ¦‚åœ¨2mså·¦å³ï¼Œä½†åœ¨å¼€å§‹æ—¶è€—æ—¶åœ¨10mså·¦å³ï¼Œé€’å‡åˆ°2mså¹¶ç¨³å®šã€‚å¯¹æ¯”å‘ç°WebRTCå¤„ç†æ•ˆç‡æ›´å¥½äº›ã€‚</p><p>ä»å¤„ç†æµç¨‹ä¸Šçœ‹éƒ½æ˜¯éœ€è¦initã€processã€freeæ“ä½œçš„ï¼Œå¯¹æ¥å…¥æ–¹æ¥å…¥æˆæœ¬æ˜¯ä¸€è‡´çš„ã€‚</p><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>RNNï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œRecurrent Neural Networksï¼Œä¸Šï¼‰å’ŒLSTMï¼ˆé•¿çŸ­æœŸè®°å¿†Long Short Term Memoryï¼Œä¸‹ï¼‰</p><img src="/555ed0ac/2.webp"> <img src="/555ed0ac/3.webp"><hr><h3 id="å˜éŸ³"><a href="#å˜éŸ³" class="headerlink" title="å˜éŸ³"></a>å˜éŸ³</h3><p>å¯¹äºå˜å£°çš„å¤„ç†ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><h4 id="å˜é€Ÿåˆå˜è°ƒ"><a href="#å˜é€Ÿåˆå˜è°ƒ" class="headerlink" title="å˜é€Ÿåˆå˜è°ƒ"></a>å˜é€Ÿåˆå˜è°ƒ</h4><p>å³æ”¹å˜éŸ³é¢‘çš„é€Ÿåº¦ï¼ˆè¯­é€Ÿï¼‰ï¼Œåˆæ”¹å˜éŸ³é¢‘çš„é¢‘ç‡ï¼ˆéŸ³è°ƒï¼‰</p><p>æˆ‘ä»¬å¯ä»¥å¯¹åŸå§‹éŸ³é¢‘è¿›è¡Œé‡é‡‡æ ·ï¼Œé‡é‡‡æ ·æœ‰ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·ï¼Œåˆ†åˆ«æ˜¯å¯¹åŸå§‹éŸ³é¢‘è¿›è¡Œæ’å€¼å’ŒæŠ½å–ï¼Œæ¯”å¦‚P&#x2F;Qé‡é‡‡æ ·ï¼Œä¸€èˆ¬æˆ‘ä»¬çš„å¤„ç†æ˜¯ï¼Œå…ˆå¯¹åŸå§‹éŸ³é¢‘è¿›è¡Œæ’å€¼ï¼Œåœ¨ç›¸é‚»ä¸¤ç‚¹é—´æ’å…¥Pä¸ªé‡‡æ ·ç‚¹ï¼Œå…¨éƒ¨æ’å…¥ç»“æŸåå†æ¯éš”Qä¸ªé‡‡æ ·ç‚¹è¿›è¡Œé‡‡æ ·ï¼Œè¿™æ ·å¾—åˆ°çš„éŸ³é¢‘è¯­é€Ÿå’ŒéŸ³è°ƒéƒ½æ˜¯åŸæ¥çš„Q&#x2F;På€</p><p>å˜è°ƒåˆå˜é€Ÿï¼ˆæé«˜ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å˜è°ƒåˆå˜é€Ÿï¼ˆæé«˜ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] up(<span class="type">byte</span>[] data, <span class="type">int</span> up) &#123;</span><br><span class="line">    <span class="keyword">if</span> (up == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> data.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">upLength</span> <span class="operator">=</span> length / up;</span><br><span class="line">    <span class="type">byte</span>[] upData = <span class="keyword">new</span> <span class="title class_">byte</span>[upLength];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; length; ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j &gt;= upLength) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        upData[j] = data[i];</span><br><span class="line">        i += up;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> upData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜è°ƒåˆå˜é€Ÿï¼ˆé™ä½ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] down(<span class="type">byte</span>[] data, <span class="type">int</span> down) &#123;</span><br><span class="line">    <span class="keyword">if</span> (down == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> data.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">downLength</span> <span class="operator">=</span> length * down;</span><br><span class="line">    <span class="type">byte</span>[] downData = <span class="keyword">new</span> <span class="title class_">byte</span>[downLength];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; length - <span class="number">1</span>; ) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; down; k++) &#123;</span><br><span class="line">            downData[j] = data[i];</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> downData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å˜é€Ÿä¸å˜è°ƒ"><a href="#å˜é€Ÿä¸å˜è°ƒ" class="headerlink" title="å˜é€Ÿä¸å˜è°ƒ"></a>å˜é€Ÿä¸å˜è°ƒ</h4><p>åªæ”¹å˜è¯­é€Ÿï¼Œä¸æ”¹å˜éŸ³è°ƒ</p><p>åªæ˜¯æ”¹å˜è¯­é€Ÿçš„è¯ï¼Œé‚£ä¹ˆå°±è¦ç¨å¾®å¤æ‚ç‚¹ï¼Œå’Œé‡é‡‡æ ·æ–¹æ³•å·®ä¸å¤šï¼ŒåŒºåˆ«åœ¨äºæˆ‘ä»¬éœ€è¦å…ˆè§„å®šä¸€å¸§éŸ³é¢‘çš„é•¿åº¦ï¼Œä¸€èˆ¬æˆ‘ä»¬çš„é‡‡æ ·ç‡è®¾ä¸º44.1KHzï¼Œä¹Ÿå°±æ˜¯ä¸€ç§’é’Ÿé‡‡æ ·44.1Kæ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥è§„å®šä¸€å¸§ä¸º1024ï¼Œæ‰€æœ‰æˆ‘ä»¬å¯ä»¥ç®€å•çš„æ ¹æ®ä¸¢å¸§å’Œé‡å¤å¸§æ¥å®ç°å˜é€Ÿä¸å˜è°ƒï¼Œæ¯”å¦‚å¯¹äºP&#x2F;Qå˜é€Ÿï¼Œæˆ‘ä»¬å…ˆå¯¹åŸå§‹éŸ³é¢‘çš„æ¯ä¸€å¸§é‡å¤Pæ¬¡ï¼Œæœ€åçš„ç»“æœå†è¿›è¡Œæ¯éš”Qå¸§å–ä¸€å¸§ï¼Œè¿™æ ·å°±å¾—åˆ°éŸ³é¢‘éŸ³è°ƒä¸å˜ï¼Œè¯­é€Ÿå˜ä¸ºQ&#x2F;Pçš„éŸ³é¢‘</p><p>å˜é€Ÿä¸å˜è°ƒï¼ˆæé«˜ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] speedUp(<span class="type">byte</span>[] data, <span class="type">int</span> up) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FRAME_LENGTH</span> <span class="operator">=</span> <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">if</span> (up == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> data.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">frameShift</span> <span class="operator">=</span> FRAME_LENGTH * up;</span><br><span class="line">    <span class="type">int</span> <span class="variable">upLength</span> <span class="operator">=</span> length / up;</span><br><span class="line">    <span class="type">byte</span>[] upData = <span class="keyword">new</span> <span class="title class_">byte</span>[upLength];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; length; ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i + FRAME_LENGTH &gt;= length) &#123;</span><br><span class="line">            System.arraycopy(data, i, upData, j, length - i);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.arraycopy(data, i, upData, j, FRAME_LENGTH);</span><br><span class="line">        i += (FRAME_LENGTH + frameShift);</span><br><span class="line">        j += FRAME_LENGTH;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> upData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜é€Ÿä¸å˜è°ƒï¼ˆé™ä½ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] speedDown(<span class="type">byte</span>[] data, <span class="type">int</span> down) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FRAME_LENGTH</span> <span class="operator">=</span> <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">if</span> (down == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> data.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">downLength</span> <span class="operator">=</span> length * down;</span><br><span class="line">    <span class="type">byte</span>[] downData = <span class="keyword">new</span> <span class="title class_">byte</span>[downLength];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; length; ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i + FRAME_LENGTH &gt;= length) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lastlength</span> <span class="operator">=</span> length - i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; down; k++) &#123;</span><br><span class="line">                System.arraycopy(data, lastlength, downData, j, lastlength);</span><br><span class="line">                j += lastlength;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; down; k++) &#123;</span><br><span class="line">            System.arraycopy(data, i, downData, j, FRAME_LENGTH);</span><br><span class="line">            j += FRAME_LENGTH;</span><br><span class="line">        &#125;</span><br><span class="line">        i += FRAME_LENGTH;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> downData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å˜è°ƒä¸å˜é€Ÿ"><a href="#å˜è°ƒä¸å˜é€Ÿ" class="headerlink" title="å˜è°ƒä¸å˜é€Ÿ"></a>å˜è°ƒä¸å˜é€Ÿ</h4><p>åªæ”¹å˜éŸ³è°ƒï¼Œä¸æ”¹å˜è¯­é€Ÿ</p><p>å¦‚æœåªæ˜¯å˜è°ƒçš„è¯ï¼Œå°±è¦ç»“åˆé‡é‡‡æ ·å’Œå˜é€Ÿä¸å˜è°ƒæ¥åšï¼Œæˆ‘ä»¬å…ˆå¯¹éŸ³é¢‘ä¿¡å·è¿›è¡Œå˜é€Ÿä¸å˜è°ƒå¤„ç†ï¼Œå†å¯¹å…¶è¿›è¡Œé‡é‡‡æ ·ï¼Œæ¯”å¦‚ï¼Œæˆ‘æƒ³è¦è®©éŸ³è°ƒå˜ä¸ºåŸæ¥çš„P&#x2F;Qå€ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å…ˆå¯¹å…¶è¿›è¡ŒP&#x2F;Qå˜é€Ÿä¸å˜è°ƒï¼Œè¯­é€Ÿå˜ä¸ºåŸæ¥çš„Q&#x2F;Pï¼Œæ¥ç€ï¼Œåœ¨å¯¹å…¶è¿›è¡ŒQ&#x2F;Pé‡é‡‡æ ·ï¼Œè¿™æ ·ï¼Œæœ€åå°±å¾—åˆ°äº†è¯­é€Ÿä¸å˜ï¼Œè€ŒéŸ³è°ƒå˜ä¸ºåŸæ¥çš„P&#x2F;Qå€</p><p>è®¾ç½®è¯­é€Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] setSpeed(<span class="type">byte</span>[] data, <span class="type">int</span> up, <span class="type">int</span> down) &#123;</span><br><span class="line">    <span class="type">byte</span>[] downData = speedDown(data, down);</span><br><span class="line">    <span class="type">byte</span>[] upData = speedUp(downData, up);</span><br><span class="line">    <span class="keyword">return</span> upData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®éŸ³è°ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] setTone(<span class="type">byte</span>[] data, <span class="type">int</span> up, <span class="type">int</span> down) &#123;</span><br><span class="line">    <span class="type">byte</span>[] speedData = setSpeed(data, down, up);</span><br><span class="line">    <span class="type">byte</span>[] downData = down(speedData, down);</span><br><span class="line">    <span class="type">byte</span>[] upData = up(downData, up);</span><br><span class="line">    <span class="keyword">return</span> upData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå°†upè®¾ä¸º4ï¼Œdownè®¾ä¸º5ï¼Œå£°éŸ³å°±å˜å¾—ä½æ²‰ã€‚</p></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/441bef73.html" rel="prev" title="CSIGäº‘ä¸Šå¾®è¡¨æƒ…-ç¬¬20æœŸ-åŸºäºè„‘ç”µçš„æƒ…æ„Ÿè®¡ç®—ç ”ç©¶"><i class="fa fa-chevron-left"></i> CSIGäº‘ä¸Šå¾®è¡¨æƒ…-ç¬¬20æœŸ-åŸºäºè„‘ç”µçš„æƒ…æ„Ÿè®¡ç®—ç ”ç©¶</a></div><div class="post-nav-item"><a href="/a580305f.html" rel="next" title="Android-éŸ³è§†é¢‘-éŸ³é¢‘å¼€å‘-ï¼ˆäº”ï¼‰éŸ³é¢‘æ’­æ”¾">Android-éŸ³è§†é¢‘-éŸ³é¢‘å¼€å‘-ï¼ˆäº”ï¼‰éŸ³é¢‘æ’­æ”¾ <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments["activeClass"];var e;(t=CONFIG.comments.storage?localStorage.getItem("comments_active")||t:t)&&(e=document.querySelector(`a[href="#comment-${t}"]`))&&e.click()}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview">ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%BC%E6%8E%A5"><span class="nav-number">1.</span> <span class="nav-text">æ‹¼æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%81%E5%89%AA"><span class="nav-number">2.</span> <span class="nav-text">è£å‰ª</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%B7%E9%9F%B3"><span class="nav-number">3.</span> <span class="nav-text">æ··éŸ³</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E5%8F%A0%E5%8A%A0%E5%90%8E%E6%B1%82%E5%B9%B3%E5%9D%87"><span class="nav-number">3.1.</span> <span class="nav-text">çº¿æ€§å åŠ åæ±‚å¹³å‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BD%92%E4%B8%80%E5%8C%96%E6%B7%B7%E9%9F%B3%EF%BC%88%E8%87%AA%E9%80%82%E5%BA%94%E5%8A%A0%E6%9D%83%E6%B7%B7%E9%9F%B3%E7%AE%97%E6%B3%95%EF%BC%89"><span class="nav-number">3.2.</span> <span class="nav-text">å½’ä¸€åŒ–æ··éŸ³ï¼ˆè‡ªé€‚åº”åŠ æƒæ··éŸ³ç®—æ³•ï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%8D%E5%99%AA"><span class="nav-number">4.</span> <span class="nav-text">é™å™ª</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%BC%80%E6%BA%90%E9%99%8D%E5%99%AA%E6%96%B9%E6%A1%88"><span class="nav-number">4.1.</span> <span class="nav-text">å¸¸è§çš„å¼€æºé™å™ªæ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RNNoise%E9%99%8D%E5%99%AA%E6%96%B9%E6%A1%88"><span class="nav-number">4.2.</span> <span class="nav-text">RNNoiseé™å™ªæ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebRTC%E9%99%8D%E5%99%AA%E6%96%B9%E6%A1%88"><span class="nav-number">4.3.</span> <span class="nav-text">WebRTCé™å™ªæ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%A4%E7%A7%8D%E9%99%8D%E5%99%AA%E6%96%B9%E6%A1%88%E9%9B%86%E6%88%90%E4%BC%98%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94"><span class="nav-number">4.4.</span> <span class="nav-text">ä¸¤ç§é™å™ªæ–¹æ¡ˆé›†æˆä¼˜ç¼ºç‚¹å¯¹æ¯”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">4.5.</span> <span class="nav-text">è¡¥å……</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%9F%B3"><span class="nav-number">5.</span> <span class="nav-text">å˜éŸ³</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%80%9F%E5%8F%88%E5%8F%98%E8%B0%83"><span class="nav-number">5.1.</span> <span class="nav-text">å˜é€Ÿåˆå˜è°ƒ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%80%9F%E4%B8%8D%E5%8F%98%E8%B0%83"><span class="nav-number">5.2.</span> <span class="nav-text">å˜é€Ÿä¸å˜è°ƒ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E8%B0%83%E4%B8%8D%E5%8F%98%E9%80%9F"><span class="nav-number">5.3.</span> <span class="nav-text">å˜è°ƒä¸å˜é€Ÿ</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Aisaka Aoi" src="/images/manatsu.jpg"><p class="site-author-name" itemprop="name">Aisaka Aoi</p><div class="site-description" itemprop="description">é€¢å‚è‘µçš„ä¸ªäººåšå®¢</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">1020</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">20</span> <span class="site-state-item-name">åˆ†ç±»</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/AisakaAoi" title="GitHub ğŸ‘¨â€ğŸ’» â†’ https:&#x2F;&#x2F;github.com&#x2F;AisakaAoi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub ğŸ‘¨â€ğŸ’»</a> </span><span class="links-of-author-item"><a href="https://github.com/Aisakaorz" title="GitHub ğŸ‘©â€ğŸ’» â†’ https:&#x2F;&#x2F;github.com&#x2F;Aisakaorz" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub ğŸ‘©â€ğŸ’»</a> </span><span class="links-of-author-item"><a href="mailto:aisakaaoi@qq.com" title="E-Mail ğŸ“§ â†’ mailto:aisakaaoi@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail ğŸ“§</a> </span><span class="links-of-author-item"><a href="mailto:chenzongnan@m.scnu.edu.cn" title="E-Mail ğŸ« â†’ mailto:chenzongnan@m.scnu.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail ğŸ«</a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/91560309" title="Bilibili ğŸ“º â†’ https:&#x2F;&#x2F;space.bilibili.com&#x2F;91560309" rel="noopener" target="_blank"><i class="fab fa-bilibili fa-fw"></i>Bilibili ğŸ“º</a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/198562921" title="Bilibili ğŸ® â†’ https:&#x2F;&#x2F;space.bilibili.com&#x2F;198562921" rel="noopener" target="_blank"><i class="fab fa-bilibili fa-fw"></i>Bilibili ğŸ®</a> </span><span class="links-of-author-item"><a href="https://www.youtube.com/channel/UCALvyn5Cl76GCotO9pczvjg" title="YouTube ğŸ“º â†’ https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCALvyn5Cl76GCotO9pczvjg" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube ğŸ“º</a></span></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2026</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Aisaka Aoi</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span> <span title="ç«™ç‚¹æ€»å­—æ•°">3.8m</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span> <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">158:10</span></div><div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&"),r="/lib/pdf/web/viewer.html?file="+encodeURIComponent(t)+a;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script>NexT.utils.loadComments(document.querySelector("#valine-comments"),()=>{NexT.utils.getScript("//unpkg.com/valine/dist/Valine.min.js",()=>{var i=["nick","mail","link"],e="nick,mail,link".split(",").filter(e=>i.includes(e));new Valine({el:"#valine-comments",verify:!0,notify:!0,appId:"UqjWdRYbIUEUQRXhBUUIh1QE-gzGzoHsz",appKey:"gj89JXC485PFbpdHLKVkz6dm",placeholder:"è¿™é‡Œå¯ä»¥å‘é€è¯„è®º~ï¼ˆä¸Šé¢å¯ä»¥è¾“å…¥æ˜µç§°ã€é‚®ç®±ï¼‰",avatar:"mm",meta:e,pageSize:"10",visitor:!0,lang:"zh-cn",path:location.pathname,recordIP:!1,serverURLs:""})},window.Valine)})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/haru02.model.json"},display:{position:"right",width:208,height:520},mobile:{show:!1},log:!1})</script></body></html>